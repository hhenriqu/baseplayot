local mysticBall = Action()

-- Listas de itens
local COMMON = {
    27449, 27450, 27451, 27452, 27453, 27454, 27455, 27456, 27457, 27458, -- Destruction items
    3399, 3398, 3397, 3366, 3364, 31582, 31583, 29418, 29428, 29429, 29427, 29426, 29424, 29423, 29422, 29421, 29420,
    660, 661, 662, 663, 664, 665, 666, 667, 668, 669, 670, 671, 672, 673, 674, 679, 680, 681, 682, 683, 684, 685, 686, 687, 688, 689, 690, 691, 692, 693, 761, 762, 763, 774, 779, 780, 781, 782, 783, 784, 785, 786, 787, 788, 789, 790, 791, 792, 793, 794, 795, 796, 797, 798, 801, 802, 803, 804, 805, 806, 807, 808, 809, 810, 860, 904, 1781, 2992, 3208, 3264, 3265, 3266, 3267, 3268, 3269, 3270, 3271, 3272, 3273, 3274, 3275, 3276, 3277, 3278, 3279, 3280, 3281, 3282, 3283, 3284, 3285, 3286, 3287, 3288, 3289, 3290, 3291, 3292, 3293, 3294, 3295, 3296, 3297, 3298, 3299, 3300, 3301, 3302, 3303, 3305, 3306, 3307, 3309, 3310, 3311, 3312, 3313, 3314, 3315, 3316, 3317, 3318, 3319, 3320, 3321, 3322, 3323, 3324, 3325, 3326, 3327, 3328, 3329, 3333, 3334, 3335, 3336, 3337, 3338, 3339, 3340, 3341, 3342, 3343, 3344, 3345, 3346, 3347, 3348, 3349, 3350, 3446, 3447, 3448, 3449, 3450, 3453, 5803, 6107, 6528, 6553, 7363, 7364, 7365, 7366, 7367, 7368, 7378, 7380, 7381, 7382, 7383, 7384, 7385, 7386, 7387, 7388, 7389, 7391, 7392, 7402, 7403, 7404, 7405, 7406, 7407, 7408, 7409, 7411, 7413, 7414, 7415, 7416, 7417, 7418, 7419, 7421, 7422, 7423, 7424, 7425, 7426, 7427, 7428, 7429, 7430, 7431, 7432, 7433, 7434, 7435, 7436, 7437, 7438, 7449, 7451, 7452, 7453, 7454, 7455, 7456, 7773, 7774, 8021, 8022, 8023, 8026, 8027, 8029, 8096, 8097, 8098, 8099, 8100, 8102, 9375, 9396, 10388, 10389, 10390, 10391, 10392, 10406, 11657, 12673, 12683, 12731, 12733, 13987, 13991, 14001, 14043, 14089, 14246, 14247, 14250, 14251, 14252, 14768, 15793, 16141, 16142, 16143, 16160, 16161, 16162, 16163, 16164, 16175, 17109, 17110, 17812, 17813, 17824, 17859, 19356, 19362, 19400, 20064, 20065, 20066, 20067, 20068, 20069, 20070, 20071, 20072, 20073, 20074, 20075, 20076, 20077, 20078, 20079, 20080, 20081, 20082, 20083, 20084, 20085, 20086, 20087, 20341,
    811, 824, 825, 826, 3357, 3358, 3359, 3360, 3361, 3366, 3370, 3377, 3378, 3379, 3380, 3381, 3383, 3386, 3388, 3394, 3397, 3399, 3402, 3404,
    139, 827, 828, 829, 830, 875, 894, 3011, 3022, 3226, 3351, 3352, 3353, 3354, 3355, 3356, 3365, 3367, 3368, 3369, 3373, 3374, 3375, 3376, 3384, 3385, 3387, 3390, 3391, 3392, 3393, 3395, 3396, 3400, 3403, 3405, 3406, 3408,
    645, 812, 821, 822, 823, 3362, 3363, 3364, 3371, 3372, 3382, 3389, 3398, 3401,
    813, 818, 819, 820, 3550, 3551, 3552, 3553, 3554, 3555, 3556, 4033, 5461, 9177
}
local RARE = {
    28714, 28715, 28716, 28717, 28718, 28719, 28720, 28721, 28722, 28723, 28724, 28725, -- Falcon items
    34150, 34151, 34152, 34153, 34154, 34155, 34156, 34157, 34158, 34253, 34254, -- Lion items
    27647, 27648, 27649, 27650, 27651, -- Gnome items
    30393, 30394, 30395, 30396, 30397, 30398, 30399, 30400, 31631, -- Cobra items
    39155, --Naga Items
    49284
}
local SUPREME = {
    34082, 34083, 34084, 34085, 34086, 34087, 34097, 34099, 34088, 34089, 34094, 34098, 34090, 34092, 34095, 34091, 34093, 34096, -- Soul items
    39147, 39148, 39177, 39149, 39150, 39180, 39151, 39152, 39183, 39153, 39154, 39186, -- Spiritthorn and Arcanomancer items
    43864, 43866, 43868, 43870, 43872, 43874, 43876, 43877, 43879, 43881, 43882, 43884, 43885, 43887, -- Sanguine items
    49285
}
local IMPOSSIBLE = {
    5903, 23684, 23685, 49283, 14758
}

-- Função para escolher um item com base na chance
local function chooseItem()
    local chance = math.random(1, 100)
    if chance <= 60 then
        return COMMON[math.random(1, #COMMON)]
    elseif chance <= 93 then
        return RARE[math.random(1, #RARE)]
    elseif chance <= 99 then
        return SUPREME[math.random(1, #SUPREME)]
    else
        return SUPREME[math.random(1, #IMPOSSIBLE)]
    end
end

function mysticBall.onUse(player, item, fromPosition, target, toPosition, isHotkey)
    -- Primeiro item
    local firstItem = chooseItem()
    player:addItem(firstItem, 1)

    -- 5% de chance de ganhar um item extra
    local randomLoot = math.random(1, 20)
    if randomLoot == 1 then
        player:sendTextMessage(MESSAGE_EVENT_ADVANCE, "You received a extra item.")
        local extraItem = chooseItem()
        player:addItem( extraItem, 1)
    end

    -- Efeito mágico e remoção do item
    item:remove(1)
    
    return true
end

mysticBall:id(49283)
mysticBall:register()